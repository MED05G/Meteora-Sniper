"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withG = exports.withF = void 0;
/**
 * Make sure to explicitly declare or cast `acquires` as a tuple using `[ResourceAcquire...]` or `as const`
 */
async function withF(acquires, f) {
    const releases = [];
    const resources = [];
    let e_;
    try {
        for (const acquire of acquires) {
            const [release, resource] = await acquire(resources);
            releases.push(release);
            resources.push(resource);
        }
        return await f(resources);
    }
    catch (e) {
        e_ = e;
        throw e;
    }
    finally {
        releases.reverse();
        for (const release of releases) {
            await release(e_);
        }
    }
}
exports.withF = withF;
/**
 * Make sure to explicitly declare or cast `acquires` as a tuple using `[ResourceAcquire...]` or `as const`
 */
async function* withG(acquires, g) {
    const releases = [];
    const resources = [];
    let e_;
    try {
        for (const acquire of acquires) {
            const [release, resource] = await acquire(resources);
            releases.push(release);
            resources.push(resource);
        }
        return yield* g(resources);
    }
    catch (e) {
        e_ = e;
        throw e;
    }
    finally {
        releases.reverse();
        for (const release of releases) {
            await release(e_);
        }
    }
}
exports.withG = withG;
//# sourceMappingURL=utils.js.map